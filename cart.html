<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Shop Around</title>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="css/style.css" type="text/css" media="all" />
        <script src="js/jquery-1.4.1.min.js" type="text/javascript"></script>
        <script src="js/jquery.jcarousel.pack.js" type="text/javascript"></script>
        <script src="js/jquery-func.js" type="text/javascript"></script>
        <style>
            #content {
                float: initial;
                padding-bottom: 50px;
                padding-top: 5px;
                width: 100%;
            }
            #content h2 {
                font-size: 16pt;
            }
            table, th, td {
                border: 2px solid #8b0000;
            }
            th, td {
                padding: 5px;
            }
            table {
                margin-top: 15px;
                width: 100%;
                border-collapse: collapse;
            }
            td {
                text-align: center;
            }
            td.image-row img {
                height: 110px;
            }
        </style>
    </head>
    <body>
        <!-- Shell -->
        <div class="shell" id="app">
            <!-- Header -->
            <div id="header">
                <h1 id="logo"><a href="/index.html">Shoparound</a></h1>
                <!-- Cart -->
                <div id="cart">
                    <a href="cart.html" class="cart-link">Your Shopping Cart</a>
                    <div class="cl">&nbsp;</div>
                    <span>Articles: <strong>{{ countCart }}</strong></span> &nbsp;&nbsp; <span>Cost: <strong>${{ cartCost }}</strong></span> 
                </div>
                <!-- End Cart -->
                <!-- Navigation -->
                <div id="navigation">
                    <ul>
                        <li><a href="home.html">Home</a></li>
                        <li><a href="#">Support</a></li>
                        <li><a href="#">Account</a></li>
                        <li><a href="#">The Store</a></li>
                        <li><a href="#">Contact</a></li>
                        <li><a @click="logout" href="login.html">Sign Out</a></li>
                    </ul>
                </div>
                <!-- End Navigation -->
            </div>
            <!-- End Header -->
            <!-- Main -->
            <div id="main">
                <div class="cl">&nbsp;</div>
                <!-- Content -->
                <div id="content">
                    <div>
                        <h2>Cart</h2>
                    </div>
                    <div>
                        <table class="content-table">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Product Name</th>
                                    <th>Product Price</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template v-if="cartItems.length > 0">
                                    <tr v-for="item, index in cartItems" :key="'cart-item-' + index">
                                        <td class="image-row"><img :src="'css/images/' + getProduct(item.product_id).image" alt="" /></td>
                                        <td>{{ getProduct(item.product_id).product_name }}</td>
                                        <td>${{ getProduct(item.product_id).price }}</td>
                                        <td><a @click="deleteCartItem(item.id)" href="#">Delete</a></td>
                                    </tr>
                                </template>
                                <template v-else>
                                    <tr>
                                        <td colspan="4">Your cart is empty! Go to <a href="home.html">home</a></td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                    <template v-if="cartItems.length > 0">
                        <div style="text-align: center; padding-top: 30px;">
                            <input @click="checkout" style="margin: auto" type="button" class="search-submit" value="Check Out" />
                        </div>
                    </template>
                </div>
                
            </div>
            <!-- End Main -->
            <!-- Side Full -->
            <div class="side-full">
                <!-- More Products -->
                <div class="more-products">
                    <div class="more-products-holder">
                        <ul>
                            <li><a href="#"><img src="css/images/small1.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small2.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small3.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small4.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small5.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small6.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small7.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small1.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small2.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small3.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small4.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small5.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small6.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small7.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small1.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small2.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small3.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small4.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small5.jpg" alt="" /></a></li>
                            <li><a href="#"><img src="css/images/small6.jpg" alt="" /></a></li>
                            <li class="last"><a href="#"><img src="css/images/small7.jpg" alt="" /></a></li>
                        </ul>
                    </div>
                    <div class="more-nav"> <a href="#" class="prev">previous</a> <a href="#" class="next">next</a> </div>
                </div>
                <!-- End More Products -->
                <!-- Text Cols -->
                <div class="cols">
                    <div class="cl">&nbsp;</div>
                    <div class="col">
                        <h3 class="ico ico1">Donec imperdiet</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec imperdiet, metus ac cursus auctor, arcu felis ornare dui.</p>
                        <p class="more"><a href="#" class="bul">Lorem ipsum</a></p>
                    </div>
                    <div class="col">
                        <h3 class="ico ico2">Donec imperdiet</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec imperdiet, metus ac cursus auctor, arcu felis ornare dui.</p>
                        <p class="more"><a href="#" class="bul">Lorem ipsum</a></p>
                    </div>
                    <div class="col">
                        <h3 class="ico ico3">Donec imperdiet</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec imperdiet, metus ac cursus auctor, arcu felis ornare dui.</p>
                        <p class="more"><a href="#" class="bul">Lorem ipsum</a></p>
                    </div>
                    <div class="col col-last">
                        <h3 class="ico ico4">Donec imperdiet</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec imperdiet, metus ac cursus auctor, arcu felis ornare dui.</p>
                        <p class="more"><a href="#" class="bul">Lorem ipsum</a></p>
                    </div>
                    <div class="cl">&nbsp;</div>
                </div>
                <!-- End Text Cols -->
            </div>
            <!-- End Side Full -->
            <!-- Footer -->
            <div id="footer">
                <p class="left"> <a href="#">Home</a> <span>|</span> <a href="#">Support</a> <span>|</span> <a href="#">My Account</a> <span>|</span> <a href="#">The Store</a> <span>|</span> <a href="#">Contact</a> </p>
                <p class="right"> &copy; 2020 Shop Around. Design by <a href="http://chocotemplates.com">Chocotemplates.com</a> </p>
            </div>
            <!-- End Footer -->
        </div>
        <!-- End Shell -->

        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

        <script>
            var app = new Vue({
                el: '#app',
                data: {
                    apiBaseUrl: "https://api.octankfashion.tk",
                    products: [],
                    userEmail: "",
                    cartItems: [],
                },
                methods: {
                    checkout() {
                        alert("Order Placed")
                        this.cartItems.forEach(item => {
                            this.deleteCartItem(item.id)
                        })
                    },
                    logout() {
                        window.localStorage.clear();
                    },
                    addToCart(item, name) {
                        axios.post(this.apiBaseUrl + "/cart", {email: this.userEmail, item}).then(response => {
                            console.log(response)
                            alert(name + " added to cart");
                            this.readCart();
                        })
                    },
                    getProduct(item) {
                        return this.products.find(e => e.id == item)
                    },
                    readCart() {
                        if(this.userEmail) {
                            axios.get(this.apiBaseUrl + "/cart", {
                                params: {email: this.userEmail}
                            }).then(response => {
                                console.log(response)
                                this.cartItems = response.data
                            })    
                        }
                    },
                    deleteCartItem(item) {
                        axios.delete(this.apiBaseUrl + "/cart", {
                            data: {item}
                        }).then(response => {
                            console.log(response)
                            this.readCart()
                        })                        
                    }
                },
                computed: {
                    countCart() {
                        return this.cartItems.length
                    },
                    cartCost() {
                        let amount = 0
                        this.cartItems.forEach(element => {
                            amount += this.products.find(e => e.id == element.product_id).price
                        });
                        return amount.toFixed(2)
                    }
                },
                mounted() {
                    this.userEmail = window.localStorage.getItem("email")
                    if(!this.userEmail) {
                        window.location.replace("login.html")
                    } else {
                        axios.get(this.apiBaseUrl + "/products").then(response => {
                            console.log(response)
                            this.products = response.data
                        })
                        this.readCart();                
                    }
                }

            })
        </script>

        <script>
            function callREST() {
                /*var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        document.getElementById("response").innerHTML = this.responseText;
                    }
                };
                xhttp.open("GET", "http://54.237.212.234:443/test");
                xhttp.send();*/
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "http://54.237.212.234:443/test", true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.send(JSON.stringify({
                email : window.localStorage.getItem("email")
                }));
            }
        </script>
    </body>
</html>